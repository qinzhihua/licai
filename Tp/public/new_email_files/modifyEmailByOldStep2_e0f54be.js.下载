define("user:page/setting/modifyPages/modifyEmailByOldStep2/modifyEmailByOldStep2.js",function(require,exports,module){"use strict";var glpbCommon=(require("common:widget/ui/utils/utils"),require("common:node_modules/glpb-components-common/src/index")),RRDValidator=glpbCommon.RRDValidator,service=require("common:widget/ui/service/service-factory"),settingService=service.getService("setting"),modifyEmailByOldStepTwo={init:function(){var _this=this;this.error="不能为空",this.mailType="new",this.newEmail="",$("#sub-email-update-byold-steptwo").on("click",function(){_this.sendNewEmail()}),$("#re-send-mail").on("click",function(){_this.sendEmailAgain()}),$("#new-email").keyup(function(){_this.validateEmail()})},sendNewEmail:function(){var _this2=this,that=this;if(!that.validateEmail()){var checkType=$("#check-type").val(),newEmail=$("#new-email").val(),data={checkType:checkType,email:newEmail};settingService.sendCheckNewEmail(data).then(function(res){if(res.requestStatus!==settingService.STATUS.SUCCESS){var msg=res.data?res.data.message:"请求后端服务出错, 请稍后再试";return Promise.reject(new Error(msg))}var _data=res.data;if(0==_data.status){_this2.newEmail=newEmail;var $s=$(".success");if(!$s.length)return;$(".inputs").delay(1e3).slideUp(),$s.delay(1e3).slideDown(function(){$(".step-list").removeClass("current-step3").addClass("current-step3")})}else _this2.error=_data.message,_this2.errorModal(0)}).caught(function(e){_this2.error=e.message,_this2.errorModal(0)})}},sendEmailAgain:function(){var data={mailType:this.mailType,newEmail:this.newEmail};settingService.sendCheckEmailAgain(data).then(function(res){if(res.requestStatus!==settingService.STATUS.SUCCESS){var msg=res.data?res.data.message:"请求后端服务出错, 请稍后再试";return Promise.reject(new Error(msg))}var _data2=res.data;0==_data2.status?$(".catch-success").slideDown(1e3).delay(2e3).slideUp(1e3):$(".catch-error").text(_data2.message).slideDown(1e3).delay(2e3).slideUp(1e3)}).caught(function(e){$(".catch-error").text(e.message).slideDown(1e3).delay(2e3).slideUp(1e3)})},validateEmail:function(){var newEmail=$("#new-email").val(),vali=RRDValidator.validate,isEmail=vali.isEmail(newEmail);return newEmail?isEmail?(this.error="",this.errorModal(0),!1):(this.error="请输入有效的邮箱地址",this.errorModal(0),!0):(this.error="填写新邮箱不能为空",this.errorModal(0),!0)},errorModal:function(num){$("label.error").eq(num).text(this.error),this.error?$(".ui-input-setting").eq(num).addClass("error"):$(".ui-input-setting").eq(num).removeClass("error")}};module.exports=modifyEmailByOldStepTwo});