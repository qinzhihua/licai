define("user:page/setting/modifyPages/modifyPassword/modifyPassword.js",function(require,exports,module){"use strict";var glpbUtils=(require("common:widget/ui/utils/utils"),require("common:node_modules/glpb-components-common/src/index")),service=require("common:widget/ui/service/service-factory"),settingService=service.getService("setting"),modifyPassword={init:function(){var _this=this;$("#old-password").keyup(function(){_this.validateOldPassword()}),$("#new-password").keyup(function(){_this.validateNewPassword()}),$("#repeat-password").keyup(function(){_this.validateEquelPassword()}),$("#sub-mod-pass").on("click",function(){_this.sendModify()})},sendModify:function(){var that=this;if(!that.validateOldPassword()&&!that.validateNewPassword()&&!that.validateEquelPassword()){var oldPassword=glpbUtils.rsaCrypt($("#old-password").val()),newPassword=glpbUtils.rsaCrypt($("#new-password").val()),pass={oldPassword:oldPassword,newPassword:newPassword};settingService.doResetPassword(pass).then(function(res){if(res.requestStatus!==settingService.STATUS.SUCCESS){var msg=res.data?res.data.message:"请求后端服务出错, 请稍后再试";return Promise.reject(new Error(msg))}var data=res.data;if(0==data.status){var $s=$(".success");if(!$s.length)return;$(".inputs").delay(1e3).slideUp(),$s.delay(1e3).slideDown(),setTimeout(function(){location.href="/pc/passport/index/login"},3e3)}else $(".catch-error").text(data.message)}).caught(function(e){$(".catch-error").text(e.message)})}},validateOldPassword:function(){var oldPassword=$("#old-password").val();return oldPassword?(this.error="",this.errorModal(0),!1):(this.error="原密码不能为空",this.errorModal(0),!0)},validateNewPassword:function(){var newPassword=$("#new-password").val(),isPsssGroup=!/^(?![0-9]+$)(?![a-zA-Z]+$)(?![~!@#$%^&*._]+$)[0-9A-Za-z~!@#$%^&*._]{8,16}$/.test(newPassword);return newPassword?isPsssGroup?(this.error="密码为8~16位数字、字母或符号组合",this.errorModal(1),!0):(this.error="",this.errorModal(1),!1):(this.error="新密码不能为空",this.errorModal(1),!0)},validateEquelPassword:function(){var newPassword=$("#new-password").val(),repeatPassword=$("#repeat-password").val();return repeatPassword?newPassword!=repeatPassword?(this.error="两次输入的密码不一致",this.errorModal(2),!0):(this.error="",this.errorModal(2),!1):(this.error="确认新密码不能为空",this.errorModal(2),!0)},errorModal:function(num){$("label.error").eq(num).text(this.error),this.error?$(".ui-input-setting").eq(num).addClass("error"):$(".ui-input-setting").eq(num).removeClass("error")}};module.exports=modifyPassword});